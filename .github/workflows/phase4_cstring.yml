name: Phase 4 - CString Tests

on:
  push:
    branches: [phase4-cstring, phase4-cobject, phase4-cwnd, master]
  pull_request:
    branches: [master]
  workflow_dispatch:

jobs:
  test-cstring:
    runs-on: windows-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Setup MSVC
      uses: ilammy/msvc-dev-cmd@v1
      with:
        arch: x64

    - name: Build and run CString tests
      shell: cmd
      run: |
        cl.exe /nologo /EHsc /std:c++17 /I include /Fe:test_cstring.exe tests\test_cstring.cpp
        if %ERRORLEVEL% neq 0 exit /b %ERRORLEVEL%
        test_cstring.exe
        if %ERRORLEVEL% neq 0 exit /b %ERRORLEVEL%
        echo MSVC CString tests passed!

    - name: Build and run CObject tests
      shell: cmd
      run: |
        cl.exe /nologo /EHsc /std:c++17 /I include /Fe:test_cobject.exe tests\test_cobject.cpp
        if %ERRORLEVEL% neq 0 exit /b %ERRORLEVEL%
        test_cobject.exe
        if %ERRORLEVEL% neq 0 exit /b %ERRORLEVEL%
        echo MSVC CObject tests passed!

    - name: Build and run CWnd tests
      shell: cmd
      run: |
        cl.exe /nologo /EHsc /std:c++17 /I include /Fe:test_cwnd.exe tests\test_cwnd.cpp src\mfc\appcore.cpp src\mfc\exceptions.cpp src\mfc\afxmem.cpp
        if %ERRORLEVEL% neq 0 exit /b %ERRORLEVEL%
        test_cwnd.exe
        if %ERRORLEVEL% neq 0 exit /b %ERRORLEVEL%
        echo MSVC CWnd tests passed!

    - name: Build and run Core App tests
      shell: cmd
      run: |
        cl.exe /nologo /EHsc /std:c++17 /I include /Fe:test_core_app.exe tests\test_core_app.cpp src\mfc\appcore.cpp src\mfc\exceptions.cpp src\mfc\afxmem.cpp
        if %ERRORLEVEL% neq 0 exit /b %ERRORLEVEL%
        test_core_app.exe
        if %ERRORLEVEL% neq 0 exit /b %ERRORLEVEL%
        echo MSVC Core App tests passed!
